<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wuyubeichen.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="主要内容：  理解Symbol的概念 查看Symbol的方式 符号表Symbol Table">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS高级-MachO符号分类">
<meta property="og:url" content="https://wuyubeichen.github.io/2021/11/06/iOS%E9%AB%98%E7%BA%A7-MachO%E7%AC%A6%E5%8F%B7%E5%88%86%E7%B1%BB/index.html">
<meta property="og:site_name" content="梧雨北辰的博客">
<meta property="og:description" content="主要内容：  理解Symbol的概念 查看Symbol的方式 符号表Symbol Table">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_deployment_postprocessing.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_view_macho1.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_view_macho2.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relation_table_symbol.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_compare_text.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_check.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_table_desc.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_global_local.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_global_hide.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export_check.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export_hide.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_indirect_symbol.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_common_symbol.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_common_symbol_check.png">
<meta property="article:published_time" content="2021-11-06T14:23:12.000Z">
<meta property="article:modified_time" content="2025-05-03T16:23:07.125Z">
<meta property="article:author" content="Zhou Shuai">
<meta property="article:tag" content="Mach-O">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_deployment_postprocessing.png">

<link rel="canonical" href="https://wuyubeichen.github.io/2021/11/06/iOS%E9%AB%98%E7%BA%A7-MachO%E7%AC%A6%E5%8F%B7%E5%88%86%E7%B1%BB/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>iOS高级-MachO符号分类 | 梧雨北辰的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="梧雨北辰的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
      
      
         
    <a target="_blank" rel="noopener" href="https://github.com/wuyubeichen" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">梧雨北辰的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">天行健，君子以自强不息！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyubeichen.github.io/2021/11/06/iOS%E9%AB%98%E7%BA%A7-MachO%E7%AC%A6%E5%8F%B7%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhou Shuai">
      <meta itemprop="description" content="iOS Developer, Beijing China">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="梧雨北辰的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS高级-MachO符号分类
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-06 22:23:12" itemprop="dateCreated datePublished" datetime="2021-11-06T22:23:12+08:00">2021-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-05-04 00:23:07" itemprop="dateModified" datetime="2025-05-04T00:23:07+08:00">2025-05-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">iOS高级</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>主要内容：</strong></p>
<ol>
<li>理解<code>Symbol</code>的概念</li>
<li>查看<code>Symbol</code>的方式</li>
<li>符号表<code>Symbol Table</code><span id="more"></span></li>
<li>重定位符号</li>
<li>全局符号与本地符号</li>
<li>导出符号</li>
<li>间接符号</li>
<li>弱符号</li>
<li>未初始化的全局符号</li>
<li>重新导出符号</li>
<li><code>Swift</code>符号</li>
</ol>
<h4 id="一、理解Symbol的概念"><a href="#一、理解Symbol的概念" class="headerlink" title="一、理解Symbol的概念"></a>一、理解Symbol的概念</h4><p><code>Mahc-O</code>文件中的符号表<code>Symbol Table</code>，在<code>Mach-O</code>的整个链接和运行过程中起着重要作用；</p>
<h5 id="1-符号的概念"><a href="#1-符号的概念" class="headerlink" title="1.符号的概念"></a>1.符号的概念</h5><ol>
<li><code>Symbol</code>：包含了名称(<code>String</code>)和类型等信息的数据结构，对应的是一个函数或者数据的地址；</li>
<li><code>Symbol Table</code>：保存符号信息的表；</li>
<li><code>String Table</code>：保存符号名称的表；</li>
<li><code>Indirect Symbol Table</code>：间接符号表，保存使用的外部符号，更准确一点就是使用的外部动态库的符号，它是<code>Symbol Table</code>的子集；</li>
</ol>
<h5 id="2-符号与链接"><a href="#2-符号与链接" class="headerlink" title="2.符号与链接"></a>2.符号与链接</h5><p>链接的作用：链接器把多个<code>.m文件</code>编译产生的<code>.o</code>文件和(<code>dylib</code>、<code>a</code>、<code>tbd</code>）文件，合成一个<code>Mach-O</code>格式的可执行文件；</p>
<p>链接阶段的重要目的：符号解析和重定位</p>
<ul>
<li>符号解析：将每个<code>符号</code>引用和对应的<code>符号</code>定义关联起来；</li>
<li>重定位：将每个<code>符号</code>定义与一个<code>内存位置</code>关联起来，然后修改所有对这些符号的引用；</li>
</ul>
<p>举例：二进制文件<code>main</code>中用到了二进制<code>A</code>中的函数<code>a</code>，则<code>main</code>就可以读取二进制<code>A</code>维护的符号表，进而在<code>A</code>找到函数<code>a</code>的实现；</p>
<h5 id="3-符号与调试"><a href="#3-符号与调试" class="headerlink" title="3.符号与调试"></a>3.符号与调试</h5><p><code>Xcode</code>调试时，需要通过符号表将<code>符号</code>和<code>源文件</code>映射起来，而如果将<code>调试符号</code>裁剪掉(如图，将<code>Deployment Postprocessing</code>设置为<code>YES</code>)，就会使得断点失效。<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_deployment_postprocessing.png" width="600" align=center/></p>
<p>注意：<code>Release</code>模式下是可以裁剪掉符号的，因为<code>release</code>模式下默认有<code>dsym</code>文件，调试器仍然可以从中获取到信息正常工作；</p>
<h4 id="二、查看Symbol的方式"><a href="#二、查看Symbol的方式" class="headerlink" title="二、查看Symbol的方式"></a>二、查看Symbol的方式</h4><h5 id="1-使用MachOView查看"><a href="#1-使用MachOView查看" class="headerlink" title="1.使用MachOView查看"></a>1.使用MachOView查看</h5><p>使用<code>MachOView</code>查看<code>Mach-O</code>文件，效果如下：</p>
<img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_view_macho1.png" width="600" align=center/>

<h5 id="2-使用objdump命令查看"><a href="#2-使用objdump命令查看" class="headerlink" title="2.使用objdump命令查看"></a>2.使用objdump命令查看</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看重定位符号表</span></span><br><span class="line">objdump <span class="operator">-</span>—macho <span class="operator">-</span>—reloc .o文件</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看符号表</span></span><br><span class="line">objdump <span class="operator">--</span>macho <span class="operator">--</span>syms .o文件或<span class="type">MachO文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看导出符号</span></span><br><span class="line">objdump <span class="operator">--</span>macho <span class="operator">--</span>exports<span class="operator">-</span>trie .o文件或<span class="type">Mach</span><span class="operator">-</span><span class="type">O文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看间接符号表</span></span><br><span class="line">objdump <span class="operator">--</span>macho <span class="operator">--</span><span class="keyword">indirect</span><span class="operator">-</span>symbols .o文件或<span class="type">Mach</span><span class="operator">-</span><span class="type">O文件</span></span><br></pre></td></tr></table></figure>


<h4 id="三、符号表Symbol-Table"><a href="#三、符号表Symbol-Table" class="headerlink" title="三、符号表Symbol Table"></a>三、符号表Symbol Table</h4><h5 id="1-符号表在Mach-O中的位置"><a href="#1-符号表在Mach-O中的位置" class="headerlink" title="1.符号表在Mach-O中的位置"></a>1.符号表在Mach-O中的位置</h5><p>下面的图，能够更加直观的展示<code>符号表</code>在<code>Mach-O</code>文件中的位置：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_view_macho2.png" width="600" align=center/></p>
<p>这里需要注意两个重要的<code>Load Commands</code>：</p>
<ul>
<li><code>LC_SYMTAB</code> ：描述当前<code>Mach-O</code>中的符号表信息；</li>
<li><code>LC_DYSYMTAB</code> ：描述动态连接器使用其他符号表的信息；</li>
</ul>
<p>其中<code>LC_SYMTAB</code>对应的数据结构<code>symtab_command</code>，其源码如下：<br> <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">struct</span> <span class="title class_">symtab_command</span> &#123;</span><br><span class="line">    <span class="comment">// 共有属性。指明当前描述的加载命令，当前被设置为LC_SYMTAB</span></span><br><span class="line">    uint32_t cmd ;</span><br><span class="line">    <span class="comment">// 共有属性。指明加载命令的大小，当前被设置为sizeof(symtab_command)</span></span><br><span class="line">    uint32_t cmdsize;</span><br><span class="line">    <span class="comment">// 表示从文件开始到symbol table所在位置的偏移量。symbol table用[nlist]来表示</span></span><br><span class="line">    uint32_t symoff;</span><br><span class="line">    <span class="comment">// 符号表内符号的数量</span></span><br><span class="line">    uint32_t nsyms;</span><br><span class="line">    <span class="comment">// 表示从文件开始到string table所在位置的偏移量。</span></span><br><span class="line">    uint32_t stroff;</span><br><span class="line">    <span class="comment">// 表示string table大小(以byteカ单位)</span></span><br><span class="line">    uint32_t strsize;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br><code>LC_SYMTAB</code>的使用场景：</p>
<ol>
<li>静态链接器、动态链接器链接文件时；</li>
<li>调试器寻找调试信息时；</li>
</ol>
<h5 id="2-符号表的源码分析"><a href="#2-符号表的源码分析" class="headerlink" title="2.符号表的源码分析"></a>2.符号表的源码分析</h5><p><code>Symbol Table</code>中存储着符号，而<code>Symbol</code>则是一个数据结构，包含了名称(<code>String</code>)和类型等元数据，符号对应一个函数或者数据的地址，其在代码的定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">nlist_64</span> &#123;</span><br><span class="line">    union &#123;</span><br><span class="line">        uint32_t  n_strx; <span class="comment">/* index into the string table */</span></span><br><span class="line">    &#125; n_un;</span><br><span class="line">    uint8_t n_type;        <span class="comment">/* type flag, see below */</span></span><br><span class="line">    uint8_t n_sect;        <span class="comment">/* section number or NO_SECT */</span></span><br><span class="line">    uint16_t n_desc;       <span class="comment">/* see &lt;mach-o/stab.h&gt; */</span></span><br><span class="line">    uint64_t n_value;      <span class="comment">/* value of this symbol (or stab offset) */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>代码中<code>n_strx</code>字段存储的就是符号在<code>String Table</code>的下标，符号表与符号的关系可用下图表示：</p>
<img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relation_table_symbol.png" width="600" align=center/>


<h4 id="四、重定位符号"><a href="#四、重定位符号" class="headerlink" title="四、重定位符号"></a>四、重定位符号</h4><p>概念理解：</p>
<ol>
<li>在链接生成<code>Mach-O</code>可执行文件之前，编译生成<code>.o</code>目标文件会对符号进行归类，而其中使用到的外部符号会暂存到重定位符号表中；</li>
<li>等到真正链接生成<code>Mach-O</code>文件时，这些符号会统一存到<code>Symbol Table</code>中；</li>
</ol>
<p>查看重定位符号的命令：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump <span class="operator">-</span>—macho <span class="operator">-</span>—reloc .o目标文件</span><br></pre></td></tr></table></figure>

<p>以下是验证过程：</p>
<h5 id="1-准备测试文件"><a href="#1-准备测试文件" class="headerlink" title="1.准备测试文件"></a>1.准备测试文件</h5><p>创建一个<code>main.m</code>文件，写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, const char <span class="operator">*</span> argv[]) &#123;</span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用命令分别生成<code>.o目标文件</code>与<code>Mach-O可执行文件</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang <span class="operator">-</span>fmodules <span class="operator">-</span>c main.m <span class="operator">-</span>o main.o   <span class="comment">//得到目标文件</span></span><br><span class="line">xcrun clang main.o <span class="operator">-</span>o main  <span class="comment">//得到Mach-O可执行文件</span></span><br></pre></td></tr></table></figure>
<h5 id="2-对比-Text代码段"><a href="#2-对比-Text代码段" class="headerlink" title="2.对比__Text代码段"></a>2.对比__Text代码段</h5><p>使用<code>objdump</code>命令，分别查看目标文件与可执行文件中的<code>__TEXT</code>段，对比之下会发现：<code>前者</code>的符号调用<code>callq _NSLog</code>是没有地址的。</p>
<p>控制台中显示效果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_compare_text.png" width="600" align=center/></p>
<h5 id="3-查看重定位符号表"><a href="#3-查看重定位符号表" class="headerlink" title="3.查看重定位符号表"></a>3.查看重定位符号表</h5><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_check.png" width="600" align=center/>

<h5 id="4-重定位符号表中的字段说明"><a href="#4-重定位符号表中的字段说明" class="headerlink" title="4.重定位符号表中的字段说明"></a>4.重定位符号表中的字段说明</h5><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_relocation_table_desc.png" width="600" align=center/>


<h4 id="五、全局符号与本地符号"><a href="#五、全局符号与本地符号" class="headerlink" title="五、全局符号与本地符号"></a>五、全局符号与本地符号</h4><p>概念理解：</p>
<ul>
<li>全局符号：整个工程可见的符号；比如定义一个全局变量，所有文件都能访问到；</li>
<li>本地符号：只有当前文件可访问的符号，比如在当前文件中定义一个<code>static</code>修饰的变量；</li>
</ul>
<p>查看符号的命令：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump <span class="operator">--</span>macho <span class="operator">--</span>syms .o文件或<span class="type">Mach</span><span class="operator">-</span><span class="type">O文件</span></span><br></pre></td></tr></table></figure>

<h5 id="1-验证全局符号与本地符号"><a href="#1-验证全局符号与本地符号" class="headerlink" title="1. 验证全局符号与本地符号"></a>1. 验证全局符号与本地符号</h5><p>创建一个<code>main.m</code>文件，写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">int global_init_value <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">static</span> int static_init_value <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">int main(int argc, const char <span class="operator">*</span> argv[]) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;%d&quot;</span>, static_init_value);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用命令生成可执行文件，并查看符号，效果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_global_local.png" width="600" align=center/></p>
<p>第二列符号标签的含义：</p>
<ul>
<li><code>l</code>代表本地符号；</li>
<li><code>g</code>代表全局符号；</li>
</ul>
<p>第三列符号标签的含义，按照功能区分：</p>
<ul>
<li><code>f</code>：<code>File</code>，文件；</li>
<li><code>F</code>：<code>Function</code>，方法；</li>
<li><code>O</code>：	<code>Data</code>，数据；</li>
<li><code>d</code>：	<code>Debug</code>，调试符号（链接过程中，可通过<code>OTHER_LDFLAGS = -Xlinker -S</code>参数隐藏)；</li>
<li><code>ABS</code>：	<code>Absolute</code>；</li>
<li><code>COM</code>：	<code>Common</code>；</li>
<li><code>UND</code>：	未定义；</li>
</ul>
<h5 id="2-隐藏全局符号"><a href="#2-隐藏全局符号" class="headerlink" title="2. 隐藏全局符号"></a>2. 隐藏全局符号</h5><p>除了使用<code>static</code>修饰外，还有一种隐藏全局符号的方法，那就是使用<code>__attribute__</code>编译属性；</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((visibility(<span class="string">&quot;default&quot;</span>)))  <span class="comment">//默认</span></span><br><span class="line">__attribute__((visibility(<span class="string">&quot;hideen&quot;</span>)))  <span class="comment">//隐藏</span></span><br></pre></td></tr></table></figure>
<p><code>visibility</code>：用于设置动态链接库中函数的可见性，将变量或函数设置为<code>hidden</code>，则该符号仅在本文件中可见，在其他库中则不可见；</p>
<p>测试使用<code>__attribute__</code>编译属性修改<code>global_init_value</code>变量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int global_init_value __attribute__((visibility(<span class="string">&quot;hidden&quot;</span>))) <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>重新使用命令生成<code>Mach-O可执行文件</code>，并查看符号，效果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_global_hide.png" width="600" align=center/></p>
<h4 id="六、导入符号和导出符号"><a href="#六、导入符号和导出符号" class="headerlink" title="六、导入符号和导出符号"></a>六、导入符号和导出符号</h4><p>概念理解：</p>
<ol>
<li>当前文件中使用到的<code>外部变量</code>、<code>外部方法</code>等，都属于其所属文件的导出符号；</li>
<li>导出符号一定是全局符号 ，将一个符号声明为全局，也就会默认成为导出符号，可供外界使用；</li>
<li><code>OC</code>中所有的符号都默认是导出符号；</li>
</ol>
<p>以<code>NSLog</code>为例：</p>
<ul>
<li>对于<code>Foundation</code>库来说，<code>NSLog</code>是提供外部使用的导出符号;</li>
<li>对于当前程序来说，<code>NSLog</code>使用的是从<code>Foundation</code>库中导入的符号;</li>
</ul>
<p>查看导出符号的命令：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump <span class="operator">--</span>macho <span class="operator">--</span>exports<span class="operator">-</span>trie .o文件或<span class="type">Mach</span><span class="operator">-</span><span class="type">O文件</span></span><br></pre></td></tr></table></figure>

<h5 id="1-验证导出符号"><a href="#1-验证导出符号" class="headerlink" title="1.验证导出符号"></a>1.验证导出符号</h5><p>在工程中创建一个空类<code>TestObject</code>，并在<code>main.m</code>文件中写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">int global_init_value <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">static</span> int static_init_value <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">int main(int argc, const char <span class="operator">*</span> argv[]) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;%d&quot;</span>, static_init_value);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为这里涉及多个文件，所以，测试时可以使用上节讲到<code>Mach-O</code>终端调试方法；</p>
<p>查看导出符号，结果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export.png" width="600" align=center/></p>
<p>查看符号，结果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export_check.png" width="600" align=center/><br>可以看出，导出符号正好与全局符号对应；</p>
<h5 id="2-设置符号不导出"><a href="#2-设置符号不导出" class="headerlink" title="2.设置符号不导出"></a>2.设置符号不导出</h5><p>全局符号不可剥离，但如果将其设置为不导出，符号就变成了本地符号类型了，不仅可以避免外界的错误使用，而且还可以脱符号处理，以减小<code>Mach-O</code>的体积；</p>
<p>为实现这一点，我们可以在自定义动态库时，在配置文件中增加链接器参数，具体如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：OTHER_LDFLAGS =$(inherited) -Xlinker -unexported_symbol -Xlinker +符号名</span></span><br><span class="line"><span class="type">OTHER_LDFLAGS</span> <span class="operator">=</span>$(inherited) <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span>unexported_symbol <span class="operator">-</span><span class="type">Xlinker</span> _OBJC_METACLASS_<span class="variable">$_TestObject</span></span><br><span class="line"><span class="type">OTHER_LDFLAGS</span> <span class="operator">=</span>$(inherited) <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span>unexported_symbol <span class="operator">-</span><span class="type">Xlinker</span> _OBJC_CLASS_<span class="variable">$_TestObject</span></span><br></pre></td></tr></table></figure>
<p>再次查看导出符号，已经没有了<code>OC</code>类的导出符号，控制台显示结果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_export_hide.png" width="600" align=center/></p>
<p>需要注意：由于<code>OC</code>是运行时语言，所以，不能直接使用<code>visibility(&quot;hidden&quot;)</code>；</p>
<h5 id="3-查看Mach-O中使用的库以及符号信息，并生成文件"><a href="#3-查看Mach-O中使用的库以及符号信息，并生成文件" class="headerlink" title="3.查看Mach-O中使用的库以及符号信息，并生成文件"></a>3.查看Mach-O中使用的库以及符号信息，并生成文件</h5><p>在配置文件中，增加如下设置：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OTHER_LDFLAGS</span> <span class="operator">=</span>$(inherited) <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span><span class="type">S</span> <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span>map <span class="operator">-</span><span class="type">Xlinker</span> $&#123;<span class="type">SRCROOT</span>&#125;<span class="operator">/</span><span class="type">MachOTest_Symbol</span>.text</span><br></pre></td></tr></table></figure>
<p>运行工程后将生成的文件，文件中包含以下信息：</p>
<ol>
<li>编译过程中生成的目标文件；</li>
<li>项目中使用的三方库；</li>
<li>项目中的<code>Sections</code>和<code>Symbols</code>等信息；</li>
</ol>
<h4 id="七、间接符号-Indirect-Symbol"><a href="#七、间接符号-Indirect-Symbol" class="headerlink" title="七、间接符号(Indirect Symbol)"></a>七、间接符号(Indirect Symbol)</h4><p>概念理解：</p>
<ol>
<li>间接符号就是使用的外部符号，例如：使用的系统库、外部动态库符号；</li>
<li>间接符号表中保存当前可执行文件使用的其他的动态库的符号；</li>
</ol>
<p>查看间接符号的命令：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CMD</span> <span class="operator">=</span> objdump <span class="operator">--</span>macho <span class="operator">--</span><span class="keyword">indirect</span><span class="operator">-</span>symbols .o文件或<span class="type">Mach</span><span class="operator">-</span><span class="type">O文件</span></span><br></pre></td></tr></table></figure>

<p>验证间接符号，在<code>main.m</code>文件中写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line">int main(int argc, const char <span class="operator">*</span> argv[]) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看间接符号，效果如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_indirect_symbol.png" width="600" align=center/><br>可以看到，<code>NSLog</code>就是间接符号，它属于<code>Foundation</code>动态库：</p>
<ul>
<li><code>adress</code>：表示间接符号链接地址；</li>
<li><code>name</code>：符号名；</li>
</ul>
<h4 id="八、弱符号-Weak-Symbol"><a href="#八、弱符号-Weak-Symbol" class="headerlink" title="八、弱符号(Weak Symbol)"></a>八、弱符号(Weak Symbol)</h4><p><code>Weak Reference Symbol</code>: 表示此未定义符号是弱引用；</p>
<ol>
<li>如果动态链接器找不到该符号的定义，则将其设置为<code>0</code>；</li>
<li>链接器会将此符号设置弱链接标志；</li>
</ol>
<p><code>Weak defintion Symbol</code>: 表示此符号为弱定义符号</p>
<ol>
<li>如果静态链接器或动态链接器为此符号找到另一个(非弱)定义，则弱定义将被忽略；</li>
<li>只能将合并部分中的符号标记为弱定义；</li>
</ol>
<h5 id="1-验证弱引用符号"><a href="#1-验证弱引用符号" class="headerlink" title="1.验证弱引用符号"></a>1.验证弱引用符号</h5><p>对于弱引用符号，更确切的理解是：如果未被定义(没有实现)，系统不会报错；</p>
<p>创建<code>WeakImportSymbol.h/m</code>文件，但只在其<code>.h</code>文件中定义一个没有实现体的弱引用方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void weak_import_function(void) __attribute__((weak_import));</span><br></pre></td></tr></table></figure>

<p>然后，在<code>main.m</code>中增加如下的代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &quot;WeakImportSymbol.h&quot;</span><br><span class="line">int main(int argc, char <span class="operator">*</span>argv[]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (weak_import_function) &#123;</span><br><span class="line">        weak_import_function();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时运行报错：<code>Undefined symbol: _weak_import_function</code>，因为链接时需要知道符号具体的地址在什么地方，否则就会提示错误；</p>
<p>解决方法：可以通过配置文件告诉编译器，这个符号是动态链接的，<code>dyld</code>运行时会自动查找；</p>
<p>于是，我们在配置文件中增加的配置如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// -U参数：告诉编译器该符号没有定义，需要动态查找</span></span><br><span class="line"><span class="type">OTHER_LDFLAGS</span> <span class="operator">=</span>$(inherited) <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span><span class="type">U</span> <span class="operator">-</span><span class="type">Xlinker</span> _weak_import_function</span><br></pre></td></tr></table></figure>

<p><code>Weak Reference Symbol</code>的好处：</p>
<ol>
<li>可以判断其他的库是否有这个符号，如果有这个符号就可以调用，否则就不调用；</li>
<li>可以将整个动态库文件声明成一个弱引用，也意味着如果你这个库没有导入的话，也不会报动态库找不到的错误；</li>
</ol>
<h5 id="2-验证弱定义符号"><a href="#2-验证弱定义符号" class="headerlink" title="2.验证弱定义符号"></a>2.验证弱定义符号</h5><p>创建<code>WeakSymbol.h/m</code>文件，增加代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// WeakSymbol.h</span></span><br><span class="line">int global_int_value</span><br><span class="line">void weak_function(void);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// WeakSymbol.m</span></span><br><span class="line">void weak_function(void) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;weak_function&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在<code>main.m</code>中增加如下的代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &quot;WeakSymbol.h&quot;</span><br><span class="line"></span><br><span class="line">int global_int_value;</span><br><span class="line"></span><br><span class="line">void weak_function(void) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;weak_function_main&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char <span class="operator">*</span>argv[]) &#123;</span><br><span class="line">    weak_function();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时运行报错：<code>2 duplicate symbols for architecture x86_64</code>；</p>
<p>解决方法：将任意一个文件中的全局变量声明为<code>弱定义符号</code>，这样在链接的过程<br> 中，找到符号的另一个(非弱)定义，则弱定义将被忽略，从而避免符号重定义；</p>
<p>于是，我们修改<code>WeakSymbol.h</code>中的代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int global_int_value __attribute__((<span class="keyword">weak</span>));</span><br><span class="line">void weak_function(void)  __attribute__((<span class="keyword">weak</span>));</span><br></pre></td></tr></table></figure>
<p>运行工程后，成功打印结果：<code>weak_function_main</code>；</p>
<h5 id="3-弱定义的本地符号"><a href="#3-弱定义的本地符号" class="headerlink" title="3.弱定义的本地符号"></a>3.弱定义的本地符号</h5><p>将弱定义的符号声明成一个隐藏符号，它就会变成了一个弱定义的本地符号：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void weak_hidden_function(void) __attribute__((<span class="keyword">weak</span>, visibility(<span class="string">&quot;hidden&quot;</span>)));</span><br></pre></td></tr></table></figure>


<h4 id="九、未初始化的全局符号-Common-Symbol"><a href="#九、未初始化的全局符号-Common-Symbol" class="headerlink" title="九、未初始化的全局符号(Common Symbol)"></a>九、未初始化的全局符号(Common Symbol)</h4><p>概念理解：在定义时未初始化的全局符号；</p>
<p>符号作用：</p>
<ol>
<li>在编译和链接的过程中，如果找到定义的符号，会自动将未定义符号删掉；</li>
<li>在链接过程中，链接器默认会把未定义符号变成强制定义的符号；</li>
</ol>
<p>链接器设置：</p>
<ul>
<li><code>-d</code>：强制定义<code>Common Symbol</code>；</li>
<li><code>-commons</code>：指定对待<code>Common Symbol</code>如何响应；</li>
</ul>
<h5 id="1-查看Common-Symbol"><a href="#1-查看Common-Symbol" class="headerlink" title="1.查看Common Symbol"></a>1.查看Common Symbol</h5><p>在<code>main.m</code>文件，写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int global_uninit_value;</span><br><span class="line"></span><br><span class="line">int main(int argc, char <span class="operator">*</span>argv[]) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看符号表，控制台显示如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_common_symbol.png" width="600" align=center/></p>
<h5 id="2-验证Common-Symbol的作用"><a href="#2-验证Common-Symbol的作用" class="headerlink" title="2.验证Common Symbol的作用"></a>2.验证Common Symbol的作用</h5><p>在<code>main.m</code>文件，写入代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int global_init_value <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">int global_init_value;</span><br><span class="line"></span><br><span class="line">int main(int argc, char <span class="operator">*</span>argv[]) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看符号表，控制台显示如下：<br><img src="https://cdn.jsdelivr.net/gh/wuyubeichen/cdn-resources/blog/symbol_common_symbol_check.png" width="600" align=center/></p>
<h4 id="十、重新导出符号"><a href="#十、重新导出符号" class="headerlink" title="十、重新导出符号"></a>十、重新导出符号</h4><p>概念理解：</p>
<ol>
<li>重新导出符号就是通过对间接符号起别名的方式，将其变成导出符号；</li>
<li>重新导出之后的符号会放在本文件的导出符号表中，此时外界究竟可以查看使用这个符号了；</li>
<li>重新导出符号可以让一个<code>符号</code>可见，也可以让一个<code>动态库</code>可见；</li>
</ol>
<p>举例：当程序链接<code>动态库A</code>，而<code>动态库A</code>又链接<code>动态库B</code>时，<code>动态库B</code>对于程序来说是不可见的，此时就可以使用重新导出符号的方式，使<code>动态库B</code>对程序可见；</p>
<h5 id="2-验证重新导出NSLog"><a href="#2-验证重新导出NSLog" class="headerlink" title="2.验证重新导出NSLog"></a>2.验证重新导出NSLog</h5><p>其实，<code>Foundation</code>已经对<code>NSLog</code>做了重新导出，否则外界是无法使用的；</p>
<p>查看当前符号表，可以看到，<code>NSLog</code>对于当前工程来说还是一个未定义符号：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000000000</span>         <span class="operator">*</span><span class="type">UND</span><span class="operator">*</span> _NSLog</span><br></pre></td></tr></table></figure>
<p>现在，我们尝试自己重新导出<code>NSLog</code>符号，可以在配置文件中修改链接器中的参数<code>-alias(起别名)</code>，具体的配置如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OTHER_LDFLAGS</span> <span class="operator">=</span> $(inherited) <span class="operator">-</span><span class="type">Xlinker</span> <span class="operator">-</span>alias <span class="operator">-</span><span class="type">Xlinker</span> _NSLog <span class="operator">-</span><span class="type">Xlinker</span> <span class="type">ZS_NSLog</span></span><br></pre></td></tr></table></figure>
<p>再次查看符号表，此时将看到<code>ZS_NSLog</code>成为导出符号，而且被标记为<code>re-export</code>；</p>
<h4 id="十一、Swift符号"><a href="#十一、Swift符号" class="headerlink" title="十一、Swift符号"></a>十一、Swift符号</h4><p>创建一个<code>SwiftSymbol.swift</code>文件，在其中增加代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PrivateObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testMethod</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublicObject</span>&#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testMethod</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看当前符号表，控制台的效果如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0000000100003bb0 l     <span class="type">F</span> __TEXT,__text <span class="keyword">_</span><span class="variable">$s9MachOTest13PrivateObject33_C45E5A1705242B42AFDE1C0627FBB932LLC10testMethodyyF</span></span><br><span class="line"></span><br><span class="line"><span class="operator">....</span></span><br><span class="line">0000000100003c80 g     <span class="type">F</span> __TEXT,__text <span class="keyword">_</span><span class="variable">$s9MachOTest12PublicObjectC10testMethodyyF</span></span><br></pre></td></tr></table></figure>
<p>结果分析：</p>
<ol>
<li><code>Swift</code>文件产生的符号要比<code>OC</code>文件多出很多；</li>
<li>作为访问控制修饰符的<code>public</code>、<code>private</code>，分别对应着去全局符号(<code>g</code>)、本地符号(<code>l</code>)两种类型；</li>
</ol>
<h4 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h4><ol>
<li><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/machoview/">MachView软件下载地址</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/DreamcoffeeZS/TestProjects/tree/main/01.MachO%E4%B8%8E%E7%AC%A6%E5%8F%B7">文中相关Demo下载地址</a></li>
</ol>

    </div>

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Zhou Shuai
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://wuyubeichen.github.io/2021/11/06/iOS%E9%AB%98%E7%BA%A7-MachO%E7%AC%A6%E5%8F%B7%E5%88%86%E7%B1%BB/" title="iOS高级-MachO符号分类">https://wuyubeichen.github.io/2021/11/06/iOS高级-MachO符号分类/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Mach-O/" rel="tag"># Mach-O</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/04/iOS%E9%AB%98%E7%BA%A7-MachO%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/" rel="prev" title="iOS高级-MachO简单分析">
      <i class="fa fa-chevron-left"></i> iOS高级-MachO简单分析
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/08/iOS%E9%AB%98%E7%BA%A7-%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%8E%E5%8A%A8%E6%80%81%E5%BA%93/" rel="next" title="iOS高级-静态库与动态库">
      iOS高级-静态库与动态库 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%90%86%E8%A7%A3Symbol%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">一、理解Symbol的概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%AC%A6%E5%8F%B7%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">1.符号的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E7%AC%A6%E5%8F%B7%E4%B8%8E%E9%93%BE%E6%8E%A5"><span class="nav-number">1.2.</span> <span class="nav-text">2.符号与链接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E7%AC%A6%E5%8F%B7%E4%B8%8E%E8%B0%83%E8%AF%95"><span class="nav-number">1.3.</span> <span class="nav-text">3.符号与调试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%9F%A5%E7%9C%8BSymbol%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">二、查看Symbol的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8MachOView%E6%9F%A5%E7%9C%8B"><span class="nav-number">2.1.</span> <span class="nav-text">1.使用MachOView查看</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8objdump%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B"><span class="nav-number">2.2.</span> <span class="nav-text">2.使用objdump命令查看</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%AC%A6%E5%8F%B7%E8%A1%A8Symbol-Table"><span class="nav-number">3.</span> <span class="nav-text">三、符号表Symbol Table</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%AC%A6%E5%8F%B7%E8%A1%A8%E5%9C%A8Mach-O%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">1.符号表在Mach-O中的位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E7%AC%A6%E5%8F%B7%E8%A1%A8%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">3.2.</span> <span class="nav-text">2.符号表的源码分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%AC%A6%E5%8F%B7"><span class="nav-number">4.</span> <span class="nav-text">四、重定位符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.</span> <span class="nav-text">1.准备测试文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%AF%B9%E6%AF%94-Text%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="nav-number">4.2.</span> <span class="nav-text">2.对比__Text代码段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%9F%A5%E7%9C%8B%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%AC%A6%E5%8F%B7%E8%A1%A8"><span class="nav-number">4.3.</span> <span class="nav-text">3.查看重定位符号表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E9%87%8D%E5%AE%9A%E4%BD%8D%E7%AC%A6%E5%8F%B7%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E"><span class="nav-number">4.4.</span> <span class="nav-text">4.重定位符号表中的字段说明</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%9C%AC%E5%9C%B0%E7%AC%A6%E5%8F%B7"><span class="nav-number">5.</span> <span class="nav-text">五、全局符号与本地符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%AA%8C%E8%AF%81%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%9C%AC%E5%9C%B0%E7%AC%A6%E5%8F%B7"><span class="nav-number">5.1.</span> <span class="nav-text">1. 验证全局符号与本地符号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E9%9A%90%E8%97%8F%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7"><span class="nav-number">5.2.</span> <span class="nav-text">2. 隐藏全局符号</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%AF%BC%E5%85%A5%E7%AC%A6%E5%8F%B7%E5%92%8C%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">6.</span> <span class="nav-text">六、导入符号和导出符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%AA%8C%E8%AF%81%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">6.1.</span> <span class="nav-text">1.验证导出符号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%AE%BE%E7%BD%AE%E7%AC%A6%E5%8F%B7%E4%B8%8D%E5%AF%BC%E5%87%BA"><span class="nav-number">6.2.</span> <span class="nav-text">2.设置符号不导出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%9F%A5%E7%9C%8BMach-O%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%BA%93%E4%BB%A5%E5%8F%8A%E7%AC%A6%E5%8F%B7%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%B9%B6%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6"><span class="nav-number">6.3.</span> <span class="nav-text">3.查看Mach-O中使用的库以及符号信息，并生成文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%97%B4%E6%8E%A5%E7%AC%A6%E5%8F%B7-Indirect-Symbol"><span class="nav-number">7.</span> <span class="nav-text">七、间接符号(Indirect Symbol)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%BC%B1%E7%AC%A6%E5%8F%B7-Weak-Symbol"><span class="nav-number">8.</span> <span class="nav-text">八、弱符号(Weak Symbol)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%AA%8C%E8%AF%81%E5%BC%B1%E5%BC%95%E7%94%A8%E7%AC%A6%E5%8F%B7"><span class="nav-number">8.1.</span> <span class="nav-text">1.验证弱引用符号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E9%AA%8C%E8%AF%81%E5%BC%B1%E5%AE%9A%E4%B9%89%E7%AC%A6%E5%8F%B7"><span class="nav-number">8.2.</span> <span class="nav-text">2.验证弱定义符号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%BC%B1%E5%AE%9A%E4%B9%89%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%AC%A6%E5%8F%B7"><span class="nav-number">8.3.</span> <span class="nav-text">3.弱定义的本地符号</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7-Common-Symbol"><span class="nav-number">9.</span> <span class="nav-text">九、未初始化的全局符号(Common Symbol)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%9F%A5%E7%9C%8BCommon-Symbol"><span class="nav-number">9.1.</span> <span class="nav-text">1.查看Common Symbol</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E9%AA%8C%E8%AF%81Common-Symbol%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">9.2.</span> <span class="nav-text">2.验证Common Symbol的作用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E9%87%8D%E6%96%B0%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">10.</span> <span class="nav-text">十、重新导出符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E9%AA%8C%E8%AF%81%E9%87%8D%E6%96%B0%E5%AF%BC%E5%87%BANSLog"><span class="nav-number">10.1.</span> <span class="nav-text">2.验证重新导出NSLog</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81Swift%E7%AC%A6%E5%8F%B7"><span class="nav-number">11.</span> <span class="nav-text">十一、Swift符号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%EF%BC%9A"><span class="nav-number">12.</span> <span class="nav-text">参考链接：</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhou Shuai"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Zhou Shuai</p>
  <div class="site-description" itemprop="description">iOS Developer, Beijing China</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wuyubeichen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wuyubeichen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/DreamcoffeeZS" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;DreamcoffeeZS" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/8451823772526" title="掘金 → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;8451823772526" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>掘金</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/32a54fe899ef" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;32a54fe899ef" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>简书</a>
      </span>
  </div>



      </div>

      <div id="days"></div>
<script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("05/27/2017 15:13:14");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
    secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
    e_daysold=timeold/msPerDay
    daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i) {
    if (i<10) {
        i="0" + i
    };
    return i;
}
show_date_time();
</script>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhou Shuai</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">249k</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共97.1k字</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '2e6fa2ad89748dbf4116',
      clientSecret: 'f9c89ddcbf94ec2d51bf77a2741a883278b6c9e9',
      repo        : 'wuyubeichen.github.io',
      owner       : 'wuyubeichen',
      admin       : ['wuyubeichen'],
      id          : 'e5d5794d9cb88f1683cd44c013383143',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
